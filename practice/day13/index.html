<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>스마트디바이스 실습13주차</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="../../css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="pt-sm-5 navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <div id="nav-top">

            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../../index.html">portfolio</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#smart-device">스마트디바이스란?</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#Sum">요약</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#End">배운점</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container-fluid p-0">
            <!-- About-->
            <section class="resume-section pb-1" id="about">
                <div class="resume-section-content">
                    <h3 class="mb-0">
                        스마트 디바이스 실습 13주차
                    </h3>
                    <div class="subheading mb-3">
                        MQTT & Nod red
                    </div>
                    <p class="lead">
                        한세대학교 컴퓨터공학과 22학번 김선영
                    </p>
                </div>
            </section>
            <hr class="m-0" />
            <!-- Experience-->
            <section class="resume-section" id="experience">
                <div class="resume-section-content mb-5">
                    <h3 class="mb-4">MQTT to Node-red</h3>
                    <ol>
                        <li>Node-RED 설치:</li>
                        코드에서 주어진 값인 "MQTT_TestClient"와 1883은 MQTT 브로커의 설정과 일치하는 경우가 많기 때문에 기본값으로 사용됨.
                        <br><br>
                        <li>MQTT 노드 추가:</li>
                        Node-RED의 플로우 에디터에서 MQTT 노드를 추가. MQTT 노드는 MQTT 브로커에 연결하고 MQTT 메시지를 전송 및 수신할 수 있는 노드. Node-RED 패키지 관리자를 통해 MQTT 노드를 설치할 수 있음.
                        <br><br>
                        <li>MQTT 설정:</li>
                        MQTT 노드를 구성하기 위해 MQTT 브로커의 호스트, 포트, 주제 등을 설정. 이를 통해 Node-RED에서 MQTT 브로커에 연결하고 메시지를 주고받을 수 있음.
                        <br><br>
                        <li>MQTT 메시지 처리:</li>
                        MQTT 노드를 통해 수신한 MQTT 메시지를 원하는 방식으로 처리할 수 있음. 예를 들어, 메시지를 필터링하거나 데이터를 가공하여 원하는 대상에게 전송하는 등의 작업을 수행할 수 있음. Node-RED의 다른 노드와 함께 조합하여 데이터 처리 및 제어 흐름을 구성할 수 있음.
                    </ol>

                    <hr class="mt-5">
                    <div id="diagram" class="d-flex flex-column flex-md-row justify-content-between mb-3 mt-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-4">실습 : MQTT를 통해 온습도 데이터 Node-red에 출력</h3>
                            <h5 class="mt-3">실습 과정</h5>
                                <div class="card-group">
                                    <div class="card p-2">
                                      <div class="card-body">
                                        <p class="card-text">
                                            <ol>
                                                <li>http://www.mqtt-dashboard.com/ 접속, 로그인</li>
                                                <br><br>
                                                <li>https://www.hivemq.com/demos/websocket-client/ SETTING</li>
                                                <a href="https://github.com/sunbang123/Smart_device/assets/93497158/076cc8ad-0e18-4755-9d23-7eddef3b2f40">[참고 이미지]</a>
                                                <br><br>
                                                <li>EspMQTTClient 라이브러리 설치</li>
                                                <a href="https://github.com/sunbang123/Smart_device/assets/93497158/069d537f-8bf3-432e-bb87-6ab7dddc52c9">[참고 이미지]</a>
                                                <br><br>
                                                <li>코드 작성, ESP32 연결 -> 업로드</li>
                                                <br><br>
                                                <li>Serial Monitor와 MQTT에서 온습도 확인</li>
                                                    - Serial Monitor
                                                    <a href="https://github.com/sunbang123/Smart_device/assets/93497158/dc32958e-54d2-44b1-ae8b-a938c2fd3f3d">[참고 이미지]</a>
                                                    <br><br>    
                                                    - MQTT
                                                    <a href="https://github.com/sunbang123/Smart_device/assets/93497158/1e9173c6-08b1-43aa-a7c4-98016f8188c8">[참고 이미지]</a>
                                                    <br><br> 
                                            </ol>   
                                            </p>
                                        </div>
                                      </div>
                                      <div class="card p-2">
                                        <div class="card-body">
                                          <p class="card-text">
                                            <p>6. Node-Red 설정</p>
                                            <img src="https://github.com/sunbang123/Smart_device/assets/93497158/cb956c80-7717-4266-afbd-40687c9285cf" class="img-fluid" alt="Responsive image">
                                            <img src="https://github.com/sunbang123/Smart_device/assets/93497158/03c3a761-bf4a-42e7-9ecd-8c01afaee639" class="img-fluid" alt="Responsive image">
                                            <ol style="list-style-type:inherit">
                                                <li>노드를 group으로 묶음.</li>
                                                <br><br>
                                            </ol>   
                                            </p>
                                          </div>
                                        </div>
                                        <div class="card p-2">
                                            <div class="card-body">
                                              <p class="card-text">
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/cfed8ef5-9501-41a0-a970-d105d48e152f" class="img-fluid" alt="Responsive image">
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/b3996d98-be97-4e66-b482-dfca0f5b8fd3" class="img-fluid" alt="Responsive image">
                                                <ol style="list-style-type:inherit">
                                                    <li>MQTT, MQTT브로커 노드 설정</li>
                                                    <br><br>
                                                </ol>   
                                                </p>
                                              </div>
                                            </div>
                                        </div>
                                        
                                        <br><br>
                                        <p>7. Node-Red 대시보드 확인</p>

                                        <img src="https://github.com/sunbang123/Smart_device/assets/93497158/61d34a50-9a73-4fa5-a6cf-75291816777a" class="img-fluid" alt="Responsive image">
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="mb-4">코드</h3>

                        <pre>
                            <code>
    #include &lg;WiFi.h> //WIFI 라이브러리
    #include &lg;EspMQTTClient.h> // PubSubclient 라이브러리를 포함한 ESP32 MQTT Client 라이브러리
    #include &lg;DHT.h> //DHT11 라이브러리
    #define DHTTYPE DHT11 // DHT 센서 타입 정의
    
    DHT dht(13, DHTTYPE); //DHT 설정 dht( 핀, DHT 종류)
    float temp1,humid1;
    char temp[10]; // temp, humid 를 문자열로 합쳐서 전송하기 위한 변수 정의
    char humid[10];
    
    EspMQTTClient client(
        "[wifi 이름]", // SSID
        "[wifi 비밀번호]", // PW
    //바꾸지 말것!!
        "broker.mqtt-dashboard.com", // MQTT Broker 서버 IP
        "MQTT_TestClient", // 클라이언트 이름
        1883 // MQTT 포트번호
    );
    //WiFiClient client;
    void setup()
    {
        Serial.begin(115200); //Initialize serial
        dht.begin();
        client.enableDebuggingMessages();
        client.enableLastWillMessage("TestClient/lastwill", "I am going offline");
    }
    void onConnectionEstablished(){
    }
    void loop() {
        client.loop();
        temp1 = dht.readTemperature(); // 온도를 읽어서 tem에 저장
        humid1 = dht.readHumidity(); // 습도를 읽어서 hum에 저장
        sprintf(temp, "%.2f" ,dht.readTemperature());
        sprintf(humid, "%.2f" ,dht.readHumidity());
        Serial.print(F("Humidity : "));
        Serial.println(humid1);
        Serial.print(F("Temperature : "));
        Serial.println(temp1);
        client.publish("mytopic/temp", temp);
        client.publish("mytopic/humid", humid);
        delay(5000);
    }</code></pre>

    </div>
                    <hr class="mb-5">
                    <div id="End" class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h4 class="mb-3">실습을 통해 느낀점</h4>
                            <ol style="list-style-type:inherit">
                                <li>이 예제를 통해 MQTT와 ESP32, DHT11 센서, Node-RED의 조합을 통해 간단한 IoT 애플리케이션을 구축하는 방법을 배움.</li>
                                <li>MQTT를 사용하면 손쉽게 센서 데이터를 게시하고 다양한 클라이언트와 통신할 수 있음.</li>
                                <li>MQTT 브로커는 MQTT 메시지를 수신하고 게시하는 중앙 허브 역할을 함.</li>
                                <li>이 예제에서는 mqtt-dashboard.com이라는 공개 MQTT 브로커를 사용.</li>
                                <li>MQTT 브로커에 연결하여 데이터를 게시하고 구독하는 방법을 배움.</li>
                                <li>Node-RED를 사용하면 시각적인 인터페이스를 통해 데이터를 처리하고 출력하는 작업을 쉽게 수행할 수 있음.</li>
                                <li>시각적 플로우 기반 프로그래밍 도구인 Node-RED를 사용하여 MQTT 메시지를 구독하고 데이터를 출력하는 대시보드를 만들 수 있음을 배움.</li>
                            </ol>
                        </div>

                        </div>
                    <hr class="mb-3">
                    <a style="text-align: left;" href="../day12/index.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                            <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                          </svg>
                        Previous
                    </a>
                    <span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>
                    <a style="text-align: right;" href="../day14.1/index.html">
                        Next
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                            <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                          </svg>
                    </a>
                </div>
            </div>
            </div>
                </div>
            </section>
            <hr class="m-0" />
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="../../js/scripts.js"></script>
    </body>
</html>