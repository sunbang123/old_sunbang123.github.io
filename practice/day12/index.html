<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>스마트디바이스 실습12주차</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="../../css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="pt-sm-5 navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <div id="nav-top">

            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../../index.html">portfolio</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#smart-device">스마트디바이스란?</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#Sum">요약</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#End">배운점</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container-fluid p-0">
            <!-- About-->
            <section class="resume-section pb-1" id="about">
                <div class="resume-section-content">
                    <h3 class="mb-0">
                        스마트 디바이스 실습 12주차
                    </h3>
                    <div class="subheading mb-3">
                        MQTT
                    </div>
                    <p class="lead">
                        한세대학교 컴퓨터공학과 22학번 김선영
                    </p>
                </div>
            </section>
            <hr class="m-0" />
            <!-- Experience-->
            <section class="resume-section" id="experience">
                <div class="resume-section-content mb-5">
                    <h3 class="mb-4">MQTT란?</h3>
                    <p>- Message Queuing Telemetry Transport의 약자, 경량의 publish/subscribe 메시징 프로토콜.</p>                    
                    <h5 class="mb-4">MQTT 프로토콜의 기본 개념과 동작 방식</h5>
                    <p>- MQTT의 핵심 구성 요소 / 클라이언트, 브로커, 토픽(topic)</p>                    
                    <ol>
                        <li>클라이언트 : MQTT 네트워크에 연결되는 디바이스 또는 응용 프로그램. 브로커에게 메시지를 발행(publish)하거나 구독(subscribe)할 수 있음.</li>
                        <li>브로커 : 클라이언트 간의 메시지 전달을 중개하는 중앙 서버 역할.</li>
                        <li>토픽 : 메시지를 구분하는 주제를 나타냄.</li>
                    </ol>

                    <hr class="mt-5">
                    <div id="diagram" class="d-flex flex-column flex-md-row justify-content-between mb-3 mt-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-4">실습 : MQTT를 사용하여 DHT11 센서로부터 온도와 습도 데이터를 받아와 출력</h3>
                            <h5 class="mt-3">실습 구성도</h5>
                            <img src="https://github.com/sunbang123/Smart_device/assets/93497158/f87c00cb-66dc-4a92-aede-4109e9a78a6d" class="img-fluid" alt="Responsive image">
                            <br><br>
                            <p>DHT11 - ESP32 <- WiFi -> Internet <-> MQTT 브로커 <- Internet ->MQTT Client(PC)</p>
                            <h5 class="mt-3">실습 과정</h5>
                                <div class="card-group">
                                    <div class="card p-2">
                                      <div class="card-body">
                                        <p class="card-text">
                                            <ol>
                                                <li>http://www.mqtt-dashboard.com/ 접속, 로그인</li>
                                                <br><br>
                                                <li>https://www.hivemq.com/demos/websocket-client/ SETTING</li>
                                                <a href="https://github.com/sunbang123/Smart_device/assets/93497158/076cc8ad-0e18-4755-9d23-7eddef3b2f40">[참고 이미지]</a>
                                                <br><br>
                                                <li>EspMQTTClient 라이브러리 설치</li>
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/069d537f-8bf3-432e-bb87-6ab7dddc52c9" class="img-fluid" alt="Responsive image">
                                                <br><br>
                                                <li>코드 작성, ESP32 연결 -> 업로드</li>
                                        </p>
                                        </div>
                                      </div>
                                      <div class="card p-2">
                                        <div class="card-body">
                                          <p class="card-text">
                                                <p>5. Serial Monitor와 MQTT에서 온습도 확인</>
                                                - Serial Monitor
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/dc32958e-54d2-44b1-ae8b-a938c2fd3f3d" class="img-fluid" alt="Responsive image">
                                                - MQTT
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/1e9173c6-08b1-43aa-a7c4-98016f8188c8" class="img-fluid" alt="Responsive image">
                                            </p>
                                          </div>
                                        </div>
                                      <div class="card p-2">
                                        <div class="card-body">
                                          <p class="card-text">
                                            <p>번외 : 스마트폰 앱 MQTT Brocker App에서 온습도 확인.</p>
                                            <ol style="list-style-type:inherit">
                                                <li>new connection</li>
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/b3c2a1b4-0406-48ef-b03e-5e55dd13d0ad" class="img-fluid" alt="Responsive image">
                                                <br><br>
                                                <li>new topic</li>
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/0e4f1d65-cfee-4a5a-9497-20618931e732" class="img-fluid" alt="Responsive image">
                                                <br><br>
                                                <li>connect</li>
                                                <img src="https://github.com/sunbang123/Smart_device/assets/93497158/77588a1b-21f0-4a0c-8f7f-016b9f4d2cff" class="img-fluid" alt="Responsive image">
                                                <br><br>
                                              </ol>    
                                        </p>
                                          </div>
                                        </div>
                                    </div>

                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="mb-4">코드</h3>

                        <pre>
                            <code>
    #include &lg;WiFi.h> //WIFI 라이브러리
    #include &lg;EspMQTTClient.h> // PubSubclient 라이브러리를 포함한 ESP32 MQTT Client 라이브러리
    #include &lg;DHT.h> //DHT11 라이브러리
    #define DHTTYPE DHT11 // DHT 센서 타입 정의
    
    DHT dht(13, DHTTYPE); //DHT 설정 dht( 핀, DHT 종류)
    float temp1,humid1;
    char temp[10]; // temp, humid 를 문자열로 합쳐서 전송하기 위한 변수 정의
    char humid[10];
    
    EspMQTTClient client(
        "[wifi 이름]", // SSID
        "[wifi 비밀번호]", // PW
    //바꾸지 말것!!
        "broker.mqtt-dashboard.com", // MQTT Broker 서버 IP
        "MQTT_TestClient", // 클라이언트 이름
        1883 // MQTT 포트번호
    );
    //WiFiClient client;
    void setup()
    {
        Serial.begin(115200); //Initialize serial
        dht.begin();
        client.enableDebuggingMessages();
        client.enableLastWillMessage("TestClient/lastwill", "I am going offline");
    }
    void onConnectionEstablished(){
    }
    void loop() {
        client.loop();
        temp1 = dht.readTemperature(); // 온도를 읽어서 tem에 저장
        humid1 = dht.readHumidity(); // 습도를 읽어서 hum에 저장
        sprintf(temp, "%.2f" ,dht.readTemperature());
        sprintf(humid, "%.2f" ,dht.readHumidity());
        Serial.print(F("Humidity : "));
        Serial.println(humid1);
        Serial.print(F("Temperature : "));
        Serial.println(temp1);
        client.publish("mytopic/temp", temp);
        client.publish("mytopic/humid", humid);
        delay(5000);
    }</code></pre>

    <h5 class="mt-3">client.enableDebuggingMessages();</h5>
    <ol style="list-style-type:inherit">
        <li>클라이언트의 디버깅 메시지를 활성화하는 데 사용.</li>
        <li>일반적으로 디버깅 메시지는 개발 중에 소프트웨어의 동작을 추적하고 문제를 해결하는 데 도움을 줌.</li>
        <li>이 함수를 호출하면 클라이언트는 디버깅 메시지를 생성하고 출력하게 됨.</li>
        <li>이를 통해 클라이언트의 내부 동작 및 네트워크 통신과 관련된 문제를 식별할 수 있음.</li>
      </ol>    

      <h5 class="mt-3">client.enableLastWillMessage("TestClient/lastwill", "I am going offline");</h5>
      <ol style="list-style-type:inherit">
          <li>LastWillMessage는 클라이언트가 비정상적으로 연결이 끊어질 경우 브로커 또는 다른 클라이언트에게 전송되는 메시지.</li>
          <li>여기서 "TestClient/lastwill"은 의지 메시지를 전송할 주제(topic), "I am going offline"는 메시지 내용.</li>
          <li>이 함수를 호출하면 클라이언트가 연결이 끊어진 경우에 자동으로 해당 메시지를 전송하게 됨.</li>
          <li>이를 통해 클라이언트의 연결 상태를 추적하고 연결이 끊어진 경우 다른 클라이언트나 시스템에 알리는 데 사용할 수 있음.</li>
        </ol>    
  
    </div>
    <hr class="mb-5">

    <div class="flex-grow-1">
        <h3 class="mb-4">MQTT 브로커 설정 기본값</h3>

    <pre>
        <code>
    EspMQTTClient client(
        "[wifi 이름]", // SSID
        "[wifi 비밀번호]", // PW
      //바꾸지 말것!!
        "broker.mqtt-dashboard.com", // MQTT Broker 서버 IP
        "MQTT_TestClient", // 클라이언트 이름
        1883 // MQTT 포트번호
    );
        </code></pre>

        - 위 실습 코드에서는 client 객체를 생성하고 MQTT 브로커에 연결하기 위한 정보를 설정하고 있음.
<ol style="list-style-type:inherit">
<li>MQTT 브로커에 연결하기 위해 설정해야 하는 값 : WiFi ID, WiFi PW, MQTT Broker 주소, Client ID, Port 번호.</li>
</ol>
- 클라이언트 ID와 포트 번호는 MQTT 브로커에 연결하기 위한 식별자와 포트 정보를 나타냄.
<ol style="list-style-type:inherit">
    <li>코드에서 주어진 값인 "MQTT_TestClient"와 1883은 MQTT 브로커의 설정과 일치하는 경우가 많기 때문에 기본값으로 사용됨.</li>
</ol>    
</div>
                    <hr class="mb-5">
                    <div id="End" class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h4 class="mb-3">실습을 통해 느낀점</h4>
                            <p>배운 점:</p>
                            <ol style="list-style-type:inherit">
                                <li>MQTT 프로토콜의 기본 개념: MQTT는 클라이언트-브로커 모델을 기반으로 하며, 클라이언트는 메시지를 발행(publish)하거나 구독(subscribe)하여 메시지를 주고받음.</li>
                                <li>MQTT의 핵심 구성 요소: MQTT 클라이언트, MQTT 브로커, 토픽(topic)은 MQTT 프로토콜에서 중요한 구성 요소. 클라이언트는 메시지를 발행하고 구독하며, 브로커는 클라이언트 간의 메시지 전달을 중개함. 토픽은 메시지를 구분하는 주제를 나타냄.</li>
                                <li>MQTT 브로커 설정: MQTT 브로커는 MQTT 메시지를 수신하고 게시하는 중앙 서버로 역할을 함. 실습에서 사용한 "broker.mqtt-dashboard.com"은 MQTT 브로커의 IP 주소를 나타냄.</li>
                            </ol>

                         <p>새롭게 알게된 점:</p>
                         <ol style="list-style-type:inherit">
                             <li>EspMQTTClient 라이브러리: 실습에서 사용된 EspMQTTClient는 ESP32 기반의 MQTT 클라이언트를 구현하기 위한 라이브러리. 이 라이브러리를 사용하면 ESP32를 MQTT 브로커에 연결하고 데이터를 발행할 수 있음.</li>
                             <li>DHT11 센서: DHT11은 온도와 습도를 측정하는 디지털 센서로 사용됨. DHT11 라이브러리를 사용하여 센서로부터 데이터를 읽어오는 방법을 배울 수 있음.</li>
                            </ol>
                        </div>

                        </div>
                    <hr class="mb-3">
                    <a style="text-align: left;" href="../day11/index.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                            <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                          </svg>
                        Previous
                    </a>
                    <span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>
                    <a style="text-align: right;" href="../day13/index.html">
                        Next
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                            <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                          </svg>
                    </a>
                </div>
            </div>
            </div>
                </div>
            </section>
            <hr class="m-0" />
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="../../js/scripts.js"></script>
    </body>
</html>